{
  "info": {
    "name": "{AppName} - Complete API Collection",
    "_postman_id": "{app-name}-api-collection-v2",
    "description": "Comprehensive API test suite for {AppName} with authentication, profiles, storage, realtime, and edge functions",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": {
      "major": 2,
      "minor": 0,
      "patch": 0
    }
  },
  "variable": [
    {
      "key": "SUPABASE_URL",
      "value": "http://localhost:54321",
      "description": "Supabase URL (localhost for development, production URL for deployed)"
    },
    {
      "key": "SUPABASE_ANON_KEY",
      "value": "your-local-anon-key",
      "description": "Supabase anonymous key (get from supabase status after supabase start)"
    },
    {
      "key": "USER_JWT_TOKEN",
      "value": "",
      "description": "JWT token for authenticated user (obtained from auth login response)"
    },
    {
      "key": "USER_ID",
      "value": "",
      "description": "Authenticated user's UUID (obtained from auth login response)"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{USER_JWT_TOKEN}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "üîê Authentication",
      "item": [
        {
          "name": "Sign Up",
          "request": {
            "method": "POST",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Content-Type", "value": "application/json"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"email\": \"test@example.com\", \"password\": \"password123\"}"
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/auth/v1/signup",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["auth", "v1", "signup"]
            }
          }
        },
        {
          "name": "Sign In",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('USER_JWT_TOKEN', response.access_token);",
                  "    pm.collectionVariables.set('USER_ID', response.user.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Content-Type", "value": "application/json"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"email\": \"test@example.com\", \"password\": \"password123\"}"
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/auth/v1/token?grant_type=password",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["auth", "v1", "token"],
              "query": [{"key": "grant_type", "value": "password"}]
            }
          }
        },
        {
          "name": "Get Current User",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/auth/v1/user",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["auth", "v1", "user"]
            }
          }
        },
        {
          "name": "Sign Out",
          "request": {
            "method": "POST",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/auth/v1/logout",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["auth", "v1", "logout"]
            }
          }
        }
      ]
    },
    {
      "name": "üë§ User Profiles",
      "item": [
        {
          "name": "Get My Profile",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/user_profiles?user_id=eq.{{USER_ID}}&select=*",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "user_profiles"],
              "query": [
                {"key": "user_id", "value": "eq.{{USER_ID}}"},
                {"key": "select", "value": "*"}
              ]
            }
          }
        },
        {
          "name": "Update My Profile",
          "request": {
            "method": "PATCH",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"},
              {"key": "Content-Type", "value": "application/json"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"full_name\": \"Updated Name\", \"avatar_url\": \"https://example.com/avatar.jpg\"}"
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/user_profiles?user_id=eq.{{USER_ID}}",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "user_profiles"],
              "query": [{"key": "user_id", "value": "eq.{{USER_ID}}"}]
            }
          }
        },
        {
          "name": "Get All Profiles (Public Data)",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/user_profiles?select=id,full_name,avatar_url,created_at",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "user_profiles"],
              "query": [
                {"key": "select", "value": "id,full_name,avatar_url,created_at"}
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üìù Posts (Realtime)",
      "item": [
        {
          "name": "Create Post",
          "request": {
            "method": "POST",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"},
              {"key": "Content-Type", "value": "application/json"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"title\": \"My First Post\", \"content\": \"This is the content of my first post.\"}"
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/posts",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "posts"]
            }
          }
        },
        {
          "name": "Get All Posts",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/posts?select=*,user_profiles(full_name)&order=created_at.desc",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "posts"],
              "query": [
                {"key": "select", "value": "*,user_profiles(full_name)"},
                {"key": "order", "value": "created_at.desc"}
              ]
            }
          }
        },
        {
          "name": "Get My Posts",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/posts?user_id=eq.{{USER_ID}}&select=*&order=created_at.desc",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "posts"],
              "query": [
                {"key": "user_id", "value": "eq.{{USER_ID}}"},
                {"key": "select", "value": "*"},
                {"key": "order", "value": "created_at.desc"}
              ]
            }
          }
        },
        {
          "name": "Update My Post",
          "request": {
            "method": "PATCH",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"},
              {"key": "Content-Type", "value": "application/json"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"title\": \"Updated Post Title\", \"content\": \"Updated content here.\"}"
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/posts?user_id=eq.{{USER_ID}}&id=eq.POST_ID_HERE",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "posts"],
              "query": [
                {"key": "user_id", "value": "eq.{{USER_ID}}"},
                {"key": "id", "value": "eq.POST_ID_HERE"}
              ]
            }
          }
        },
        {
          "name": "Delete My Post",
          "request": {
            "method": "DELETE",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/posts?user_id=eq.{{USER_ID}}&id=eq.POST_ID_HERE",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "posts"],
              "query": [
                {"key": "user_id", "value": "eq.{{USER_ID}}"},
                {"key": "id", "value": "eq.POST_ID_HERE"}
              ]
            }
          }
        }
      ]
    },
    {
      "name": "üìÅ Storage",
      "item": [
        {
          "name": "List Avatars Bucket",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/storage/v1/object/list/avatars",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["storage", "v1", "object", "list", "avatars"]
            }
          }
        },
        {
          "name": "Upload Avatar",
          "request": {
            "method": "POST",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "",
                  "description": "Upload an image file"
                }
              ]
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/storage/v1/object/avatars/{{USER_ID}}.jpg",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["storage", "v1", "object", "avatars", "{{USER_ID}}.jpg"]
            }
          }
        },
        {
          "name": "Get Avatar Public URL",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/storage/v1/object/public/avatars/{{USER_ID}}.jpg",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["storage", "v1", "object", "public", "avatars", "{{USER_ID}}.jpg"]
            }
          }
        },
        {
          "name": "List My Documents",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/storage/v1/object/list/documents/{{USER_ID}}",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["storage", "v1", "object", "list", "documents", "{{USER_ID}}"]
            }
          }
        },
        {
          "name": "Upload Document",
          "request": {
            "method": "POST",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {
                  "key": "file",
                  "type": "file",
                  "src": "",
                  "description": "Upload a document file"
                }
              ]
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/storage/v1/object/documents/{{USER_ID}}/document.pdf",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["storage", "v1", "object", "documents", "{{USER_ID}}", "document.pdf"]
            }
          }
        }
      ]
    },
    {
      "name": "‚ö° Edge Functions",
      "item": [
        {
          "name": "Hello World Function",
          "request": {
            "method": "POST",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"},
              {"key": "Content-Type", "value": "application/json"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"name\": \"Postman User\"}"
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/functions/v1/hello-world",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["functions", "v1", "hello-world"]
            }
          }
        },
        {
          "name": "Upload Avatar via Function",
          "request": {
            "method": "POST",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "body": {
              "mode": "formdata",
              "formdata": [
                {"key": "avatar", "type": "file", "src": "", "description": "Upload an avatar image"}
              ]
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/functions/v1/user-avatar",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["functions", "v1", "user-avatar"]
            }
          }
        },
        {
          "name": "Get Current Avatar via Function",
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/functions/v1/user-avatar",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["functions", "v1", "user-avatar"]
            }
          }
        }
      ]
    },
    {
      "name": "üîí Security Tests",
      "item": [
        {
          "name": "‚ùå Unauthenticated Profile Access",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Should deny unauthenticated access', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([403, 401]);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"}
            ],
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/user_profiles?select=*",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "user_profiles"],
              "query": [{"key": "select", "value": "*"}]
            }
          }
        },
        {
          "name": "‚ùå Try to Update Other User's Post",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Should not update other user post', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([403, 401]);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {"key": "apikey", "value": "{{SUPABASE_ANON_KEY}}"},
              {"key": "Authorization", "value": "Bearer {{USER_JWT_TOKEN}}"},
              {"key": "Content-Type", "value": "application/json"}
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"title\": \"Hacked Title\"}"
            },
            "url": {
              "raw": "{{SUPABASE_URL}}/rest/v1/posts?user_id=eq.OTHER_USER_ID",
              "host": ["{{SUPABASE_URL}}"],
              "path": ["rest", "v1", "posts"],
              "query": [{"key": "user_id", "value": "eq.OTHER_USER_ID"}]
            }
          }
        }
      ]
    }
  ]
}
